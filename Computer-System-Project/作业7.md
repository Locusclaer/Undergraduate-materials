# 分布式原子性与一致性
|姓名|学号|
|----|----|
|翟一航|23020011046|
### 问题1：假设连接小明的客户端到服务器S1和S2的网络速度快且可靠，但是客户端和S3之间的网络经常停止工作，每次停止几分钟。小明的系统在这种情况下会有什么表现?
- A.CLIENTWRITE通常需要几分钟或更长时间才能完成。
- B. CLIENTREAD通常需要几分钟或更长时间才能完成。
- C.CLIENTWRITE经常无法更新所有的服务器。
- D. CLIENTREAD通常会失败，返回“false”

A

从代码中可以看出，对于 read 过程，客户端会依次尝试对 s1 到 s3 这三个服务器进行读取，只要其中有成功读取的就结束程序，返回数据库中信息。由于 s1 和 s2 的网络速度很快且可靠，并且 read 尝试是从 s1 开始，所以大概率不会有机会尝试 s3 服务器，read 操作通常能够很快完成。对于 write 过程，从代码中可以看到，如果无法成功写入会不断循环，直到写入成功，并依次对三个服务器都是这样的操作，即必须保证三个服务器都成功写入，因而由于客户端和 s3 之间的网络不稳定，write 操作可能通常需要几分钟或更长时间来完成。

### 问题2：假设没有故障。CLIENTREAD调用将返回什么字符串?
在无故障的情况下，每次 write 都会更新三个服务器的数据库中的内容，但是由于没有设置任何的并发控制，所以每次的 write 都会覆盖上次的内容，因而最终三个服务器的数据库中应该都是 Breakfast，故 CLIENTREAD 调用将返回 Breakfast。

### 问题3：小明可能会看到下列哪一个结果?
- A. Breakfast at 10, Talk to Frans at 11
- B. Talk to Frans at 10, Talk to Frans at 11
- C. Breakfast at 10, Free at 11
- D. Free at 10, Talk to Frans at 1

A B

A：在重启之前，系统已经完成了第四次的写操作，对于第五次的写操作也已经修改了部分服务器的数据库，可能出现这种正常情况下的预期结果。

B：若重启发生在第四次写操作与第五次写操作之间，此时第四次写操作已经修改了部分服务器的数据库，但是还没有来得及尽行第五次写操作，就可能出现这种情况。

C：若读取到10点的内容是 Breakfast，那么说明此时第五次写操作已经修改了部分服务器的数据库，之前的四次写操作都已经全部完成，读取到的11点的内容应该是 Takl To Fans。

D：若读取到的10点的内容是 Free，那么说明重启发生在第三次写操作之前，此时读取到的11点的内容应该是 Free。

### 问题4：小明变得有点偏执，所以他调用CLIENTREAD (0,10)两次，看看他的数据库是否一致。小明可能会看到下列哪一个结果?
- A. Breakfast at 10, Breakfast at 10
- B. Talk to Frans at 10, Talk to Frans at 10
- C. Free at 10, Breakfast at 10
- D. Talk to Frans at 10, Free at 10

A B

由于每个写操作都会更新所有服务器的数据库，并且顺序执行，所以重启之后先后读取的所有服务器的同一时间点的内容都应该是一致的。如果重启发生在第五次写操作和结束之间，就会出现 A 的结果，如果重启发生在第三次写操作和第五次写操作之间，就会出现 B 的结果。

### 问题5：随着小华的改变，下列哪一个v1，v2，v3的序列是可能的?
- A. X, Y, Z
- B. X, Z, Y
- C. X, X, Z
- D. X, Y, X

A C D

更改代码后，写入操作对于每个服务器也只进行一次，不管成功与否。根据选项可以假设第一次写入操作更新了部分服务器（也有可能是全部服务器），并且之后的第一次读取操作也是成功读取到了写入的 X。接下来是第二次的写入操作，不知道此次操作成功与否，若写入完全成功，接下来读取操作则会读取到 Y；若写入部分成功，但是读取没有问题则会读取到 Y，但是前面的服务器读取失败则有可能读取到 X；若写入失败则会读取到 X。第三次写入操作同理，若成功则会读取到 Z，若部分成功结合第二次写入的分析，可以得出第三次可能读取到 X、Y、Z 中的任意一个字符；失败则可能是前两次的任意一个结果。

### 问题6：在小明原本的系统中，下列哪个v1，v2，v3的序列是可能的?
- A. X, Y, Z
- B. X, Z, Y
- C. X, X, Z
- D. X, Y, X

A

小明原本的系统中每个写入操作都会保证所有服务器都被成功写入，因而应该是正常的 X、Y、Z 序列。