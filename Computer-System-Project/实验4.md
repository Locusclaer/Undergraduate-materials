# 网络诊断工具Traceroute
|姓名|学号|成绩评定|
|----|----|----|
|翟一航|23020011046||

## 1. 实验目的
1. 学习Ping和Traceroute工具的使用，能够在网络开发和维护中 熟练使用该工具获取网络状态和进行错误排查。
2. 巩固课堂学习的因特网分层设计实现知识，理解因特网的分组 转发网络的特性，通过分析互联网数据包因转发而产生的时延， 加深理解尽力而为的因特网设计思想。
3. 通过分析ICMP协议，学习在分层设计中进行跨层通信的设计实 现方法，思考因特网网络层在错误处理上的折中设计和处理技巧。
4. 通过Traceroute工具基于错误处理包进行路径探测功能的设计， 体会在实践中体会设计方案在解决问题的同时是如何带来新的设 计机会的。

## 2. 实验过程与习题
### 2.1 ping 应用
#### 问题1：用不超过200字简要概括ping命令；
man 命令的结果如图一所示

总结如下：
使用 ping 命令会通过 ICMP 协议向目标服务器或主机发出 ECHO_REQUEST 数据包，并等待接收 ECHO_REPLAY 回应，如果远程的目标主机运行正常，就会给出回应，如果本地无法在规定时间内收到回应，就说明目标主机可能运行不正常或者拒绝回应，会退出并返回代码，通过这种方式可以检测目标主机的状态以及网络时延情况。ping 命令可以统计往返时间、丢包率等数据，会报告重复或损坏的数据包。ping 命令参数有c、f、l、n等，可以单独或混合使用它们，来限制发送数据包的时间间隔和次数。

#### 问题2：说明实验现象背后的原因；
使用ping，对www.sdu.edu.cn发送10个长度为56字节的数据包。结果如图二所示。

使用ping，对www.ouc.edu.cn发送长度为56字节的50个数据包。结果如图三所示。

观察实验结果可以发现，向山大的网址发送的10个长度为56个字节的数据包都得到了回应，但是向海大的网址发送的50个长度为56字节的数据包都没有得到回应。可以推测出，丢包与发送数据包的数量与长度无关，与目标网址有关，海大网址可能设置了数据包过滤的防火墙，从而导致从主机发送的数据包都出现了丢包，无法被接收。

#### 问题3：通过查询资料，画出所使用的ICMP数据包的结构。
如图四所示

### traceroute 应用
#### 问题4：用不超过200字简要概括 traceroute 命令；
man 命令的结果如图五所示

阅读 description 可知，traceroute 命令用于跟踪数据包从源主机到目标主机之间的路径。Traceroute 的工作原理是发送 TTL 探测包，探测包的 TTL 逐次递增，通过观察 TTL 的消逝来返回特定的 IP 地址，如果没有得到响应就返回 *。指令执行过程为，先发送 TTL 为1的数据包，碰到第一个路由器 TTL 归零，数据包被丢弃，返回 ICMP 响应，之后发送 TTL 为2的数据包，逐次递增，直至找到目标主机。它支持 UDP、ICMP、TCP 探测，可以通过参数来调节，可用于发现路由环路、防火墙或网络中断等问题。

#### 问题5：确定并说明从源计算机到 www.baidu.com 的路径；
Tranceroute 命令的结果如图六所示

第一行表明，百度网址的 IP 地址是 182.61.200.110，最大跳数是30，每个数据包的大小是60字节。
接下来的每一行都显示了传输数据包的过程中的路由节点。
第一行 islouc 表示是本地网络的网关，第三行到第十五行可能是中间路由器的 IP 地址，16、17行接近百度服务器的 IP 地址，可能是百度的典型 IP，多个 IP 地址可能表明有多个路径到达。中间的 * 可能是因为有些服务器禁用了 ICMP/UDP 响应，导致无法获取这些节点的响应。

#### 问题6：说明输出结果每个字段的意义。
第一行中有目标网站的域名与 IP 地址，以及在试探过程中的最大跳数与每个数据包的大小。
接下来的每一行分为两种情况：
1. 如果能够找到下一个路由器，输出序号、路由器 IP 地址、时延，若输出了多个 IP 地址，表明可能有多条路径到达了该路由器。
2. 如果无法到达下一个路由器，或无法收到回应则输出 *。

### 2.3 traceroute 探索
#### 问题 7：解释 traceroute 18.31.0.200 的输出。
Tranceroute 命令的结果如图七所示

第一行中有目标 IP 地址，最大跳数30，每个数据包的大小60。
接下来的每一行分为两种情况：
1. 如果能够找到下一个路由器，输出序号、路由器 IP 地址、时延，若输出了多个 IP 地址，表明可能有多条路径到达了该路由器。有时还可能会返回网址。
2. 如果无法到达下一个路由器，或无法收到回应则输出 *。

#### 问题 8：说明从源地址到 www.baidu.com 和到 cn.bing.com 的网络路径差异。
1. 从源地址到 www.baidu.com 的路径中，30个节点中只有前半部分的大多数节点能够显示，之后的节点都无法得到回应，但是到 cn.bing.com 的路径中，几乎所有节点都显示了出来。
2. 两个网址相同序号的节点的时延相比，百度的时延较低，但是必应的时延较高，必应中国服务器可能还是走了国际路由。
3. 百度与必应的路由器 IP 地址差别较大，说明两者服务器所处的互联网地址有较大的差别。

#### 问题9：如果在 IPv6 上实现路径探测，应该使用包头的哪个字段？
Hop Limit 字段

## 3. 遇到的问题与解决方式
在使用 man 命令查看 ping 命令的用法时，发现无法找到命令的报错，使用 ping 命令测试 www.baidu.com 发现无 ping 这个命令，只能在自己的电脑上进行 ping 命令的实验。

## 4. 课后实验内容与思考
### Traceroute 在网络故障排查中有哪些应用场景?
1. 检测网络连通性问题：出现 * 说明无法到达某节点。
2. 定位高延迟或网络拥塞：通过对比各跳的延迟，来找到延迟突增的节点。
3. 识别路由环路：网络访问卡顿，并且 IP 地址循环出现则说明出现了路由环路。
4. 检测防火墙或 ACL 拦截：部分服务器无法访问，但是基本连通性正常，通过添加 T、p 参数，探测特定端口，来检查具体问题。

### 在 Traceroute 中如何通过修改参数来优化网络诊断的效果?
1. -I 参数，适合严格防火墙环境。结果见图八
2. -T 参数，使用 TCP 80/443 端口，绕过 UDP/ICMP 限制。
3. -U 参数，显式指定 UDP，调整端口避免拦截。
4. -q N 参数，减少每跳探测包的数量。结果见图九
5. -z G 参数，设置包间隔，避免被限速。
6. -m N 参数，限制最大跳数。结果见图十
7. -f N 参数，设置其起始 TTL。结果见图十一
8. -n 参数，禁用反向解析，直接显示 IP。结果见图十二
9. -e 参数，显示 AS 号，辅助识别运营商。

### Traceroute 交换源节点/目的节点，在同一时刻探测到的两条路径 应该是相同的吗?
通常不相同，可能由于路由不对称，导致入向和出向流量选择不同路径，或者由于网络设备策略差异，如：ICMP探测包处理方式不同等，造成的响应不同。

## 实验总结
在本次实验中，我学习了 ping 指令与 traceroute 指令，探索了网络连通性与路径追踪机制。使用 ping 命令测试了山大和海大网站的延迟和丢包情况，对 ping 命令有了更好的掌握。除此之外，还使用 traceroute 命令追踪了百度与中国必应网站的路径，并通过比较追踪两网站的路径差异，明确了运营商策略对路由器追踪的影响，还学习了 IPv6 中 HOP LIMIT 字段的作用。最后还通过课后实验内容的学习，对 traceroute 命令的作用与用途有了更深的了解。

通过实验，我巩固了上课所学的网络协议的理论知识，还锻炼了实际操作能力，初步掌握了 ping 命令与 traceroute 命令，学会了追踪互联网址路径、测试网址连通性的基本方法，为将来处理更复杂的网络问题打下了基础。