# Eraser
## Eraser的设计目标是什么?
调试多线程编程是一件十分困难的事，有时候简单的同步错误就可能造成与时间相关的数据竞争，偏偏这种数据竞争反而需要很长时间来定位、解决。因此，为了解决多线程编程中的错误查找问题，Eraser 被设计了出来，通过检查锁规则来进行多线程生产服务器的动态竞争检测。

## 它是如何设计以满足这些目标的？
Eraser 利用二进制重写技术，监视每一个共享内存的引用、观察一致锁行为。锁规则将每个线程之间共享的变量进行保护，确保不存在数据竞争。Eraser 使用 Locket 算法，该算法规定每个共享变量都由某个锁来保护，Eraser 可以通过监测程序执行期间的所有读写操作来检查程序是否遵守这一规则。对于每个共享变量，Eraser 都会为它维护候选锁集合，访问这个变量时，将候选锁的集合更新为与当前进程共有锁的交集，来确保任何保护该共享变量的锁都在共享锁集中。此外，Eraser 在第二个线程首次访问共享变量时，将其视为已经初始化，并且只要变量被单个线程访问就不会改变候选集，一个变量如果是只读的也不会被保护，只有初始化变量被多个线程共享写时才会报告竞争。Eraser 对共享变量的读写状态做出了明确的标识，两种状态下的共享变量拥有不同的共享锁集，并通过检查共享锁集是否为空集来确定是否出现数据竞争的问题。Eraser 接收二进制文件为输入，以添加 Locket 算法的结果的二进制文件为输出，会对每个获取或释放锁的操作以及管理线程初始化和终结进行检测，以此来维护内存的分配与调用。为了提高性能，还使用哈希表和排序向量来表示和处理锁集。并且允许用户通过注释来检查错误，提高了可靠性与稳定性。它还会提供清晰的错误报告与建议，并拥有很好的拓展性与兼容性，确保能够适用于规模不同、复杂度不同的多线程编程。

## 为什么需要这样的工具？或者说，为什么作者认为需要这样的工具？
随着多线程使用的增加，由于数据竞争导致的错误与不可靠性也会随之增多，Eraser 确实是一种用来监测数据竞争现象并对之进行避免的重要的工具。并且与静态检测的手动调试相比，动态检测的 Eraser 工具表现优良可作为补充，应当成为多线程程序测试的标准工具，并且 Locket 算法很有应用前景。此外，Eraser 工具的应用领域也很广阔，如本科生的课程作业、多线程网络搜索、SPIN操作系统的数据竞争检测等。将来可以努力在 Eraser 中加入多重保护锁与死锁检测机制，使得功能更加强大。